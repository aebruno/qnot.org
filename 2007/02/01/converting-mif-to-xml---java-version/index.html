<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Andrew E. Bruno is a software developer and GNU/Linux enthusiast. His interests include web development, high performance computing, and data visualization.">
    <meta name="author" content="Andrew E. Bruno">
    <link rel="shortcut icon" href="/favicon.ico">
    <link href="" rel="alternate" type="application/rss+xml" title="">
    <title>  Converting MIF to XML - Java Version &middot;  qnot.org</title>
    <link href="http://fonts.googleapis.com/css?family=Inconsolata:400,700" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://qnot.org//css/syntax.css">
    <link rel="stylesheet" href="http://qnot.org//css/styles.css">

    
    
  </head>

<body>

<div class="container">
<ol class="breadcrumb">
    <li><a href="/">About</a></li>
    <li><a href="/blog/">Syncopated Pandemonium</a></li>
    <li><a href="/publications/">Publications</a></li>
    <li><a href="https://github.com/aebruno">Code</a></li>
    <li><a href="/contact/">Contact</a></li>
</ol>


<div class="post">
  <h1>Converting MIF to XML - Java Version</h1>
  <div class="post-date">Thu, Feb 1, 2007</div>
      <p>In my <a href="http://qnot.org/2007/01/25/converting-mif-to-xml/">previous post</a> I discussed a
tool called <code>mif2xml</code> for converting MIF files to an intermediate XML dialect.
In this post I&rsquo;ll talk about the Java port of <code>mif2xml</code> called <code>mif2xml-j</code>
which you can download <a href="https://github.com/aebruno/mif2xml-j">here</a> including
just the <a href="https://github.com/downloads/aebruno/mif2xml-j/mif2xml-0.3.jar">executable
jar</a>.</p>

<p><a href="http://www.jflex.de/">JFlex</a> is a lexical analyzer generator for Java and is
the library I chose to use for creating the MIF lexer. The first step was to
get JFlex integrated into my build environment. For this project I decided to
use <a href="http://ant.apache.org/">ant</a> but integrating JFlex into another build
environment should be straightforward. I created the following
directory structure:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">--/
  <span class="p">|</span>-- src/main/jflex/               - JFlex lexical specifications
  <span class="p">|</span>-- src/main/resources/MANIFEST   - Defines main class <span class="k">for</span> executable jar
  <span class="p">|</span>-- src/main/java/                - Java <span class="nb">source</span>
  <span class="p">|</span>-- lib/                          - 3rd party libraries <span class="o">(</span>JFlex.jar<span class="o">)</span>
  <span class="p">|</span>-- build.xml                     - Ant build file
</code></pre></div>


<p>JFlex comes bundled with a <code>JFlexAntTask</code> which provides a very convenient
<code>&lt;jflex/&gt;</code> task. Here&rsquo;s a snippet of the ant build file I created which shows
how to set it up:
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;src&quot;</span>   <span class="na">location=</span><span class="s">&quot;${basedir}/src/main/java&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;lib&quot;</span> <span class="na">location=</span><span class="s">&quot;${basedir}/lib&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;scanner-file&quot;</span> <span class="na">value=</span><span class="s">&quot;${basedir}/src/main/jflex/mif.jflex&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;path</span> <span class="na">id=</span><span class="s">&quot;classpath&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;pathelement</span> <span class="na">location=</span><span class="s">&quot;${build}&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;fileset</span> <span class="na">dir=</span><span class="s">&quot;${lib}&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;include</span> <span class="na">name=</span><span class="s">&quot;*.jar&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/fileset&gt;</span>
<span class="nt">&lt;/path&gt;</span>

<span class="nt">&lt;taskdef</span> <span class="na">classpathref=</span><span class="s">&quot;classpath&quot;</span> <span class="na">classname=</span><span class="s">&quot;JFlex.anttask.JFlexTask&quot;</span> <span class="na">name=</span><span class="s">&quot;jflex&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;jflex&quot;</span> <span class="na">description=</span><span class="s">&quot;Generate the MIF lexer&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;echo</span> <span class="na">message=</span><span class="s">&quot;Generating the MIF Lexer&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;jflex</span> <span class="na">file=</span><span class="s">&quot;${scanner-file}&quot;</span> <span class="na">destdir=</span><span class="s">&quot;${src}&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/target&gt;</span>
</code></pre></div>
</p>

<p>I found writing the lexical specification in JFlex and flex to be very similar.
JFlex has a great <a href="http://www.jflex.de/manual.html">user manual</a> which contains
a lot of useful info. Here&rsquo;s the <code>mif.jflex</code> file:</p>

<p><div class="highlight"><pre><code class="language-java" data-lang="java"><span class="cm">/*</span>
<span class="cm"> * Copyright 2007 Andrew Bruno &lt;aeb@qnot.org&gt;</span>
<span class="cm"> * Licensed under the Apache License, Version 2.0</span>
<span class="cm"> */</span>

<span class="kn">package</span> <span class="nn">org.qnot.mif2xml</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Stack</span><span class="o">;</span>

<span class="o">%%</span>

<span class="o">%{</span>
  <span class="kd">private</span> <span class="n">Stack</span><span class="o">&lt;</span><span class="n">Tag</span><span class="o">&gt;</span> <span class="n">tags</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Stack</span><span class="o">&lt;</span><span class="n">Tag</span><span class="o">&gt;();</span>
  <span class="kd">private</span> <span class="n">StringBuffer</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuffer</span><span class="o">();</span>
  <span class="kd">private</span> <span class="n">StringBuffer</span> <span class="n">facet</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuffer</span><span class="o">();</span>
<span class="o">%}</span>

<span class="o">%</span><span class="n">line</span>
<span class="o">%</span><span class="kt">char</span>
<span class="o">%</span><span class="n">standalone</span>
<span class="o">%</span><span class="kd">class</span>  <span class="nc">MifLexer</span>
<span class="o">%</span><span class="n">xstate</span> <span class="n">DATA</span>
<span class="o">%</span><span class="n">xstate</span> <span class="n">STR</span>
<span class="o">%</span><span class="n">xstate</span> <span class="n">FACET</span>

<span class="n">ID</span><span class="o">=[</span><span class="n">A</span><span class="o">-</span><span class="n">Za</span><span class="o">-</span><span class="n">z</span><span class="o">][</span><span class="n">A</span><span class="o">-</span><span class="n">Za</span><span class="o">-</span><span class="n">z0</span><span class="o">-</span><span class="mi">9</span><span class="o">]*</span>
<span class="n">TAG</span><span class="o">=</span><span class="s">&quot;&lt;&quot;</span><span class="o">{</span><span class="n">ID</span><span class="o">}</span><span class="s">&quot; &quot;</span>
<span class="n">TAG_END</span><span class="o">=</span><span class="s">&quot;&gt;&quot;</span>
<span class="n">NONNEWLINE</span><span class="o">=[^</span><span class="err">\</span><span class="n">r</span><span class="o">|</span><span class="err">\</span><span class="n">n</span><span class="o">|</span><span class="err">\</span><span class="n">r</span><span class="err">\</span><span class="n">n</span><span class="o">]</span>
<span class="n">NEWLINE</span><span class="o">=[</span><span class="err">\</span><span class="n">r</span><span class="o">|</span><span class="err">\</span><span class="n">n</span><span class="o">|</span><span class="err">\</span><span class="n">r</span><span class="err">\</span><span class="n">n</span><span class="o">]</span>
<span class="n">WHITE_SPACE_CHAR</span><span class="o">=[</span> <span class="err">\</span><span class="n">n</span><span class="err">\</span><span class="n">t</span><span class="o">]</span>

<span class="o">%%</span>

<span class="o">&lt;</span><span class="n">YYINITIAL</span><span class="o">&gt;</span> <span class="o">{</span> 
   <span class="o">{</span><span class="n">TAG</span><span class="o">}</span>   <span class="o">{</span>
        <span class="n">Tag</span> <span class="n">tag</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Tag</span><span class="o">();</span>
        <span class="n">tag</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">yytext</span><span class="o">().</span><span class="na">substring</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">yytext</span><span class="o">().</span><span class="na">length</span><span class="o">()-</span><span class="mi">1</span><span class="o">));</span>
        <span class="n">tags</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">tag</span><span class="o">);</span>
        <span class="n">tag</span><span class="o">.</span><span class="na">writeStart</span><span class="o">();</span>
        <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuffer</span><span class="o">();</span>
        <span class="n">yybegin</span><span class="o">(</span><span class="n">DATA</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="o">{</span><span class="n">TAG_END</span><span class="o">}</span>   <span class="o">{</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">tags</span><span class="o">.</span><span class="na">empty</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">Tag</span> <span class="n">tag</span> <span class="o">=</span> <span class="o">(</span><span class="n">Tag</span><span class="o">)</span><span class="n">tags</span><span class="o">.</span><span class="na">pop</span><span class="o">();</span>
            <span class="n">tag</span><span class="o">.</span><span class="na">writeEnd</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="o">^</span><span class="s">&quot;=&quot;</span><span class="o">[</span><span class="n">a</span><span class="o">-</span><span class="n">zA</span><span class="o">-</span><span class="n">Z</span><span class="o">][</span><span class="n">a</span><span class="o">-</span><span class="n">zA</span><span class="o">-</span><span class="n">Z0</span><span class="o">-</span><span class="mi">9</span><span class="o">]*{</span><span class="n">NEWLINE</span><span class="o">}</span> <span class="o">{</span>
        <span class="n">facet</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuffer</span><span class="o">();</span>
        <span class="n">facet</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">yytext</span><span class="o">());</span>
        <span class="n">yybegin</span><span class="o">(</span><span class="n">FACET</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="o">{</span><span class="n">WHITE_SPACE_CHAR</span><span class="o">}+</span>   <span class="o">{</span>  <span class="cm">/* eat up whitespace */</span> <span class="o">}</span>
    <span class="o">{</span><span class="n">NONNEWLINE</span><span class="o">}</span>          <span class="o">{</span>  <span class="cm">/* eat up everything else  */</span> <span class="o">}</span>
<span class="o">}</span>

<span class="o">&lt;</span><span class="n">DATA</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="o">{</span><span class="n">NEWLINE</span><span class="o">}</span>  <span class="o">{</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">tags</span><span class="o">.</span><span class="na">empty</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">Tag</span> <span class="n">tag</span> <span class="o">=</span> <span class="o">(</span><span class="n">Tag</span><span class="o">)</span><span class="n">tags</span><span class="o">.</span><span class="na">pop</span><span class="o">();</span>
            <span class="n">tag</span><span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
            <span class="n">tags</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">tag</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">yybegin</span><span class="o">(</span><span class="n">YYINITIAL</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="s">&quot;`&quot;</span>  <span class="o">{</span>  <span class="n">yybegin</span><span class="o">(</span><span class="n">STR</span><span class="o">);</span> <span class="o">}</span>
    <span class="o">{</span><span class="n">TAG_END</span><span class="o">}</span>  <span class="o">{</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">tags</span><span class="o">.</span><span class="na">empty</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">Tag</span> <span class="n">tag</span> <span class="o">=</span> <span class="o">(</span><span class="n">Tag</span><span class="o">)</span><span class="n">tags</span><span class="o">.</span><span class="na">pop</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">value</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>

            <span class="n">String</span> <span class="n">dataStr</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
            <span class="k">if</span><span class="o">(</span><span class="n">dataStr</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">dataStr</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">dataStr</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="k">if</span><span class="o">(</span><span class="n">value</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">&quot;^\\s+&quot;</span><span class="o">,</span> <span class="s">&quot;&quot;</span><span class="o">);</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">&quot;\\s+$&quot;</span><span class="o">,</span> <span class="s">&quot;&quot;</span><span class="o">);</span>
            <span class="o">}</span>

            <span class="n">tag</span><span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
            <span class="n">tag</span><span class="o">.</span><span class="na">writeEnd</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="n">yybegin</span><span class="o">(</span><span class="n">YYINITIAL</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="o">[^</span><span class="err">\</span><span class="n">n</span><span class="o">|</span><span class="err">\</span><span class="n">r</span><span class="o">|</span><span class="err">\</span><span class="n">r</span><span class="err">\</span><span class="n">n</span><span class="o">|</span><span class="err">`</span><span class="o">|&gt;]</span> <span class="o">{</span>
        <span class="n">data</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">yytext</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="o">&lt;</span><span class="n">STR</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="s">&quot;&#39;&quot;</span>  <span class="o">{</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">tags</span><span class="o">.</span><span class="na">empty</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">Tag</span> <span class="n">tag</span> <span class="o">=</span> <span class="o">(</span><span class="n">Tag</span><span class="o">)</span><span class="n">tags</span><span class="o">.</span><span class="na">pop</span><span class="o">();</span>
            <span class="k">if</span><span class="o">(</span><span class="n">tag</span><span class="o">.</span><span class="na">getValue</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">tag</span><span class="o">.</span><span class="na">getValue</span><span class="o">().</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">tag</span><span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="s">&quot;`&#39;&quot;</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="n">tags</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">tag</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">yybegin</span><span class="o">(</span><span class="n">YYINITIAL</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="o">[^</span><span class="err">&#39;</span><span class="o">]*</span>  <span class="o">{</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">tags</span><span class="o">.</span><span class="na">empty</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">Tag</span> <span class="n">tag</span> <span class="o">=</span> <span class="o">(</span><span class="n">Tag</span><span class="o">)</span><span class="n">tags</span><span class="o">.</span><span class="na">pop</span><span class="o">();</span>
            <span class="n">StringBuffer</span> <span class="n">buf</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuffer</span><span class="o">();</span>
            <span class="n">buf</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;`&quot;</span><span class="o">);</span>
            <span class="n">buf</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">yytext</span><span class="o">());</span>
            <span class="n">buf</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;&#39;&quot;</span><span class="o">);</span>
            <span class="n">tag</span><span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="n">buf</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
            <span class="n">tags</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">tag</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="o">&lt;</span><span class="n">FACET</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="o">^</span><span class="s">&quot;=EndInset&quot;</span><span class="o">{</span><span class="n">NEWLINE</span><span class="o">}</span> <span class="o">{</span>
        <span class="n">facet</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">yytext</span><span class="o">());</span>
        <span class="n">Tag</span><span class="o">.</span><span class="na">writeFacet</span><span class="o">(</span><span class="n">facet</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
        <span class="n">yybegin</span><span class="o">(</span><span class="n">YYINITIAL</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="o">.*{</span><span class="n">NEWLINE</span><span class="o">}</span> <span class="o">{</span>
        <span class="n">facet</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">yytext</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
</p>

<p>I created a simple <code>Tag</code> class to encapsulate a MIF XML tag and handle writing
out each tag. The <code>MifLexer</code> keeps a stack of <code>Tag</code> instances while it&rsquo;s
processing the input file:</p>

<p><div class="highlight"><pre><code class="language-java" data-lang="java"><span class="cm">/*</span>
<span class="cm"> * Copyright 2007 Andrew Bruno &lt;aeb@qnot.org&gt;</span>
<span class="cm"> * Licensed under the Apache License, Version 2.0</span>
<span class="cm"> */</span>

<span class="kn">package</span> <span class="nn">org.qnot.mif2xml</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Tag</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">value</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getValue</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">value</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setValue</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">writeEnd</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">value</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">value</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">escape</span><span class="o">(</span><span class="n">value</span><span class="o">)</span> <span class="o">+</span> <span class="s">&quot;&lt;/&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&quot;&gt;&quot;</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&quot;&lt;/&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&quot;&gt;&quot;</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">writeStart</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&quot;&gt;&quot;</span> <span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">writeFacet</span><span class="o">(</span><span class="n">String</span> <span class="n">facet</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&quot;&lt;_facet&gt;&lt;![CDATA[&quot;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">facet</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&quot;]]&gt;&lt;/_facet&gt;&quot;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="nf">escape</span><span class="o">(</span><span class="n">String</span> <span class="n">str</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">str</span> <span class="o">=</span> <span class="n">str</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">&quot;&amp;&quot;</span><span class="o">,</span> <span class="s">&quot;&amp;&quot;</span><span class="o">);</span>
        <span class="n">str</span> <span class="o">=</span> <span class="n">str</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">&quot;\&quot;&quot;</span><span class="o">,</span> <span class="s">&quot;&quot;&quot;);</span>
<span class="s">        str = str.replaceAll(&quot;</span><span class="o">&gt;</span><span class="s">&quot;, &quot;</span><span class="o">&gt;</span><span class="s">&quot;);</span>
<span class="s">        str = str.replaceAll(&quot;</span><span class="o">&lt;</span><span class="s">&quot;, &quot;</span><span class="o">&lt;</span><span class="s">&quot;);</span>
<span class="s">        str = str.replaceAll(&quot;</span><span class="o">^</span><span class="err">\\</span><span class="n">s</span><span class="o">+</span><span class="s">&quot;, &quot;&quot;);</span>
<span class="s">        str = str.replaceAll(&quot;</span><span class="err">\\</span><span class="n">s</span><span class="o">+</span><span class="n">$</span><span class="s">&quot;, &quot;</span><span class="err">&quot;</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">str</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
</p>

<p>There&rsquo;s a separate <code>Main</code> class which creates a new instance of the <code>MifLexer</code>
class for processing the file passed in on the command line. I&rsquo;d like to
eventually extend this class so that it handles command line options and
possibly even runs some XSLT&rsquo;s over the generated MIF XML.</p>

<p><div class="highlight"><pre><code class="language-java" data-lang="java"><span class="cm">/*</span>
<span class="cm"> * Copyright 2007 Andrew Bruno &lt;aeb@qnot.org&gt;</span>
<span class="cm"> * Licensed under the Apache License, Version 2.0</span>
<span class="cm"> */</span>

<span class="kn">package</span> <span class="nn">org.qnot.mif2xml</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileNotFoundException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileReader</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">length</span> <span class="o">!=</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Usage : mif2xml &lt;inputfile&gt;&quot;</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="n">MifLexer</span> <span class="n">scanner</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MifLexer</span><span class="o">(</span><span class="k">new</span> <span class="n">FileReader</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]));</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&quot;&lt;?xml version=\&quot;1.0\&quot;?&gt;&lt;mif&gt;&quot;</span><span class="o">);</span>
            <span class="n">scanner</span><span class="o">.</span><span class="na">yylex</span><span class="o">();</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&quot;&lt;/mif&gt;&quot;</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">FileNotFoundException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;File not found : &quot;</span><span class="o">+</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
        <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;I/O error scanning file &#39;&quot;</span><span class="o">+</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]+</span><span class="s">&quot;&#39;: &quot;</span><span class="o">+</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
        <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Unexpected exception: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
</p>

<p>To run the code download the <a href="https://github.com/downloads/aebruno/mif2xml-j/mif2xml-0.3.jar">executable
jar</a> and run
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>java -jar mif2xml-0.1.jar myfile.mif
</code></pre></div>
</p>

<p>The MIF XML will be printed to stdout.</p>

</div>

</div>

    
    
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <br/>
    <br/>
    <br/>
    <br/>
    <br/>


  </body>
</html>
