<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Andrew E. Bruno is a software developer and GNU/Linux enthusiast. His interests include web development, high performance computing, and data visualization.">
    <meta name="author" content="Andrew E. Bruno">
    <link rel="shortcut icon" href="/favicon.ico">
    <title>  Creating iCalendar Files in Ruby &middot;  qnot.org</title>
	<link href="http://fonts.googleapis.com/css?family=Inconsolata:400,700" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://qnot.org/css/syntax.css">
    <link rel="stylesheet" href="http://qnot.org/css/styles.css">

    
    
  </head>

<body>

<div class="container">
<ol class="breadcrumb">
    <li><a href="/">About</a></li>
    <li><a href="/blog/">Syncopated Pandemonium</a></li>
    <li><a href="/publications/">Publications</a></li>
    <li><a href="https://github.com/aebruno">Code</a></li>
    <li><a href="/contact/">Contact</a></li>
</ol>


<div class="post">
  <h1>Creating iCalendar Files in Ruby</h1>
  <div class="post-date">Wed, Feb 7, 2007</div>
      <p>I recently came across a great ruby module called
<a href="http://icalendar.rubyforge.org/">icalendar</a> for working with
<a href="http://en.wikipedia.org/wiki/ICalendar">iCalendar</a> files. For a quick example
here&rsquo;s some code that generates the <a href="http://www.sabres.com">Buffalo Sabres</a>
06/07 schedule in iCalendar format. The source data comes from the Excel
spreadsheet available <a href="http://www.sabres.com/downloads_html.cfm">here</a> which
gets converted to CSV before running through the script.</p>

<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">&#39;rubygems&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;icalendar&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;csv&#39;</span>

<span class="k">if</span> <span class="no">ARGV</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">1</span>
    <span class="nb">puts</span> <span class="s2">&#34;usage: ruby sabres_ical [schedule.csv]&#34;</span>
    <span class="nb">exit</span><span class="p">;</span>
<span class="k">end</span>

<span class="n">cal</span> <span class="o">=</span> <span class="no">Icalendar</span><span class="o">::</span><span class="no">Calendar</span><span class="o">.</span><span class="n">new</span>

<span class="no">CSV</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="no">ARGV</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">row</span><span class="o">|</span>
    <span class="n">event</span> <span class="o">=</span> <span class="n">cal</span><span class="o">.</span><span class="n">event</span>
    <span class="n">event</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="no">DateTime</span><span class="o">.</span><span class="n">now</span>
    <span class="n">event</span><span class="o">.</span><span class="n">summary</span> <span class="o">=</span> <span class="n">row</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
    <span class="n">event</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">row</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
    <span class="n">event</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">row</span><span class="o">[</span><span class="mi">16</span><span class="o">]</span> 

    <span class="n">start_date</span> <span class="o">=</span> <span class="no">Date</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">row</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="no">Date</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">row</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="p">)</span>
    <span class="n">game_time</span> <span class="o">=</span> <span class="n">row</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span>

    <span class="n">event</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="no">DateTime</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">start_date</span><span class="o">.</span><span class="n">to_s</span> <span class="o">+</span> <span class="s2">&#34; &#34;</span> <span class="o">+</span> <span class="n">game_time</span><span class="p">)</span>

    <span class="c1"># Games usually last about 3 hours</span>
    <span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">s</span><span class="p">)</span> <span class="o">=</span> <span class="n">game_time</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;:&#34;</span><span class="p">)</span>
    <span class="n">endTime</span> <span class="o">=</span> <span class="o">[</span><span class="n">h</span><span class="o">.</span><span class="n">to_i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">s</span><span class="o">].</span><span class="n">join</span><span class="p">(</span><span class="s2">&#34;:&#34;</span><span class="p">)</span>
    <span class="n">event</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="no">DateTime</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">end_date</span><span class="o">.</span><span class="n">to_s</span> <span class="o">+</span> <span class="s2">&#34; &#34;</span> <span class="o">+</span> <span class="n">endTime</span><span class="p">)</span>
<span class="k">end</span>

<span class="nb">puts</span> <span class="n">cal</span><span class="o">.</span><span class="n">to_ical</span></code></pre></div>

<p>Here&rsquo;s an example of the output which is sent to stdout:</p>

<pre><code>BEGIN:VCALENDAR
VERSION:2.0
CALSCALE:GREGORIAN
PRODID:iCalendar-Ruby
BEGIN:VEVENT
DTEND:20061006T223000
UID:2007-01-16T17:59:38-0800_408345411@sugaree
DESCRIPTION:Sabres vs. Montreal
SUMMARY:Sabres vs. Montreal
DTSTART:20061006T193000
DTSTAMP:20070116T175938
SEQ:0
LOCATION:HOME
END:VEVENT
BEGIN:VEVENT
DTEND:20061014T220000
UID:2007-01-16T17:59:38-0800_606587692@sugaree
DESCRIPTION:Sabres vs. NY Rangers
SUMMARY:Sabres vs. NY Rangers
DTSTART:20061014T190000
DTSTAMP:20070116T175938
SEQ:0
LOCATION:HOME
END:VEVENT
</code></pre>

<p>If you&rsquo;re a Sabres fan and not able to run ruby scripts you can download the
iCal version of the <a href="/data/Sabres-06-07.ics">Sabres 06/07 schedule here</a>
for importing into your favorite <a href="http://www.mozilla.org/projects/calendar/sunbird/">calendaring</a>
program. For some reason there are some games missing in the source Excel
spreadsheet so unfortunately they will also be missing in the iCalendar
version. I don&rsquo;t make any guarantees to it&rsquo;s correctness so if you find an
error or miss a game you&rsquo;ve been warned.</p>
</div>

</div>

    
    
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <br/>
    <br/>
    <br/>
    <br/>
    <br/>


  </body>
</html>
